<?xml version="1.0" encoding="utf-8"?>
<!--
    NOTICE:

    This context is usually accessed via authenticated callers on the sip profile on port 5060
    or transfered callers from the public context which arrived via the sip profile on port 5080.

    Authenticated users will use the user_context variable on the user to determine what context
    they can access.  You can also add a user in the directory with the cidr= attribute acl.conf.xml
    will build the domains ACL using this value.
-->
<!-- http://wiki.freeswitch.org/wiki/Dialplan_XML -->
<include>
	<context name="default">
		<extension name="testing">
			<condition field="destination_number" expression="^000000(\d{4})$">
				<action application="conference" data="$1@default"/>
			</condition>
		</extension>
		<extension name="white_list_select_conference_transfer">
			<condition field="destination_number" expression="^23706$">
				<action application="transfer" data="${destination_number} XML Public"/>
			</condition>
		</extension>
		<extension name="white_list_select_conference_transfer">
			<condition field="destination_number" expression="^${PINAccessDial}$">
				<action application="transfer" data="${destination_number} XML Public"/>
			</condition>
		</extension>
		<extension name="Looped Audio">
			<condition field="destination_number" expression="^123456789$">
				<action application="answer"/>
				<action application="playback" data="tone_stream://%(100,2000,440);loops=-1"/>
			</condition>
		</extension>
		<extension name="OutboundTrunks">
			<condition field="destination_number" expression="^1111111111111111115(\d{3})$">
				<action application="answer"/>
				<action application="record_session" data="$${recordings_dir}/archive/${strftime(%Y-%m-%d-%H-%M-%S)}_${destination_number}_${caller_id_number}.wav"/>
				<action application="bridge" data="{absolute_codec_string=PCMU}sofia/gateway/CiscoSipTrunks/5$1"/>
				<action application="record_session" data="$${recordings_dir}/archive/${strftime(%Y-%m-%d-%H-%M-%S)}_${destination_number}_${caller_id_number}.wav"/>
			</condition>
		</extension>
		<extension name="Dump_5025">
			<condition field="destination_number" expression="^{ProtectedAllCall}$">
				<action application="playback" data="misc\8000\invalid_extension.wav"/>
				<action application="sleep" data="2000"/>
				<action application="hangup" data="USER_BUSY"/>
			</condition>
		</extension>
		<extension name="wired_conferences_fixed">
			<condition field="destination_number" expression="^(${FirstNumber}\d{3})$">
				<action application="log" data="INFO - Default/Wired Conferences Fixed - dest conf:${destination_number} Caller ID: + ${caller_id_number}"/>
				<action application="log" data="INFO - IN DEFAULT _ WIRED CONFERENCES FIXED"/>
				<action application="answer"/>
				<action application="managed" data="CommunicatorConnector ConferenceChecker + ${destination_number} FROM_DIALPLAN"/>
				
				<!--<action application="sched_api" data="+ 2 normal CommunicatorConnector ConferenceChecker + ${destination_number} FROM_DIALPLAN"/> -->
				<action application="set" data="api_hangup_hook=managed CommunicatorConnector ConferenceChecker - ${destination_number}"/>
				<!--<action application="set" data="conference_utils_auto_outcall_flags=ghost"/>-->
				<!--<<condition field="$1" expression="^($\d)[2-9][0-9]$">-->
				<!--<	<action application="log" data="Adding Announce Line"/>-->
				<!--<	<action application="conference_set_auto_outcall" data="aes67/endpoints/Announce"/>-->
				<!--</condition>-->
				<action application="conference" data="${destination_number}@default+flags{endconf}"/>
			</condition>
		</extension>
		<!--<action application="managed" data="CommunicatorConnector SwapFromEavesdropToDante $1 ${dante}" />-->
		<!--<action application="set" data="api_hangup_hook=managed CommunicatorConnector SwapFromDanteToEavesdrop $1 ${dante}" />-->
		<extension name="dante_dial_conference">
			<condition field="destination_number" expression="^99999(\d+)$">
				<action application="set" data="continue_on_fail=true"/>
				<action application="answer"/>
				<action application="log" data="INFO Dante Port is '${interface}'"/>
				<action application="managed" data="CommunicatorConnector AddDanteToCall $1"/>
				<action application="set" data="api_hangup_hook=managed CommunicatorConnector RemoveDanteFromCall $1 ${interface}"/>
				<action application="conference" data="$1+flags{noperpetual}"/>
				<action application="transfer" data="${destination_number}"/>
			</condition>
		</extension>
		<extension name="AnnounceTest">
			<condition field="destination_number" expression="^99$">
				<action application="sleep" data="1000"/>
				<action application="set" data="rtp_jitter_buffer_plc=true"/>
				<param name="use-jb-lookahead" value="1"/>
				<action application="jitterbuffer" data="40"/>
				<action application="answer"/>
				<action application="bridge" data="aes67/endpoints/Announce"/>
			</condition>
		</extension>
		<extension name="dante_connect">
			<condition field="destination_number" expression="^[0-9]$">
				<action application="managed" data="CommunicatorConnector OperatorChecker ${destination_number} ${uuid}"/>
				<action application="sleep" data="1000"/>
				<action application="set" data="rtp_jitter_buffer_plc=true"/>
				<param name="use-jb-lookahead" value="1"/>
				<action application="jitterbuffer" data="40"/>
				<action application="answer"/>
				<action application="bridge" data="aes67/endpoints/Operator_${destination_number}"/>
			</condition>
		</extension>
		<extension name="wired_conferences_dial_in">
			<condition field="destination_number" expression="^(\d+)(${FirstNumber}\d{3})$">
				<action application="play_and_get_digits" data="4 4 3 7000 # conference\8000\conf-pin.wav conference\8000\conf-bad-pin.wav pin_received ^1234|0000$ 2000 9999 XML default"/>
				<action application="log" data="CRIT ${pin_received}"/>
				<action application="answer"/>
				<action application="conference" data="$2@default"/>
			</condition>
		</extension>
		<extension name="conference_failed_pin">
			<condition field="destination_number" expression="^9999$">
				<action application="playback" data="ThatConferenceNumIsIncorrect.wav"/>
				<action application="sleep" data="1000"/>
			</condition>
		</extension>
		<extension name="Tone_Stream_For_Beltpacks">
			<condition field="destination_number" expression="^99998$">
				<action application="answer"/>
				<action application="set" data="api_hangup_hook=managed CommunicatorConnector LostToneStreamForBeltpacks - $1"/>
				<action application="loop_playback" data="theoperatorhasbeencalledbeep.wav"/>
			</condition>
		</extension>
		<extension name="Broadcast_Announce">
			<condition field="destination_number" expression="^99991$">
				<action application="answer"/>
				<action application="set" data="api_hangup_hook=managed CommunicatorConnector LostBroadcastAnnounce - $1"/>
				<action application="record" data="shout://source:pass@127.0.0.1:8000/stream.ogg"/>
			</condition>
		</extension>
		<extension name="non-whitelisted-people-with-correct-PIN">
			<condition field="destination_number" expression="^(\d+)$">
				<action application="set" data="api_hangup_hook=managed CommunicatorConnector ConferenceChecker - $1"/>
				<action application="playback" data="ConnectedToSystem.wav"/>
				<action application="playback" data="conference\8000\conf-conference_will_start_shortly.wav"/>
				<action application="conference_set_auto_outcall" data="aes67/endpoints/Announce"/>
				<action application="conference" data="$1"/>
			</condition>
		</extension>
	</context>
</include>